<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Lesson1@CS231n:Image Classification Pipeline | eKuL</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.1.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.2/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/2.2.3/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Lesson1@CS231n:Image Classification Pipeline</h1><a id="logo" href="/.">eKuL</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Lesson1@CS231n:Image Classification Pipeline</h1><div class="post-meta">Jun 28, 2016<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><p>Lesson 1 of <a href="https://cs231n.stanford.edu" target="_blank" rel="external">CS231n</a></p>
<h2 id="Motivation"><a href="#Motivation" class="headerlink" title="Motivation"></a>Motivation</h2><p><strong>Image Classification:</strong> assigning an input <u>image</u> one <u>label</u> from a fixed set of categories.</p>
<p><img src="/images/cat.png" alt=""></p>
<p><strong>The problem:</strong> semantic gap.</p>
<p>Images are represented as 3D array of numbers, with integers between [0, 255].</p>
<h2 id="An-image-classifier"><a href="#An-image-classifier" class="headerlink" title="An image classifier"></a>An image classifier</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">predict</span><span class="params">(image)</span>:</span></span><br><span class="line">  <span class="comment"># ???</span></span><br><span class="line">  <span class="keyword">return</span> class_label</span><br></pre></td></tr></table></figure>
<p>Unlike e.g. sorting a list of numbers.</p>
<p>There is <strong>no obvious way</strong> to hard-code the algorith for recognizing a cat!</p>
<h3 id="Data-driven-approach"><a href="#Data-driven-approach" class="headerlink" title="Data-driven approach"></a>Data-driven approach</h3><p><strong>The image classification pipeline:</strong> </p>
<ol>
<li><strong>Input:</strong> <u>Collect</u> a dataset of $N$ images with one of $K$ different labels</li>
<li><strong>Learning:</strong> Use Machine Learning algorithms to <u>train</u> an image classifier</li>
<li><strong>Evaluation:</strong> <u>Evaluate</u> the classifier on a withheld set of test images</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">def train(train_images, train_labels)</span><br><span class="line">  # build a model for images -&gt; labels</span><br><span class="line">  return model</span><br><span class="line"></span><br><span class="line">def predict(model, test_images):</span><br><span class="line">  # predict test_labels using the model</span><br><span class="line">  return test_labels</span><br></pre></td></tr></table></figure>
<p>Example training set:</p>
<p><img src="/images/trainset.jpg" alt=""></p>
<h3 id="First-Classifier-Nearest-Neighbor-Classifier"><a href="#First-Classifier-Nearest-Neighbor-Classifier" class="headerlink" title="First Classifier: Nearest Neighbor Classifier"></a>First Classifier: Nearest Neighbor Classifier</h3><h4 id="NN-Classifier"><a href="#NN-Classifier" class="headerlink" title="NN Classifier"></a>NN Classifier</h4><ol>
<li><strong>Train:</strong> remember all training images and their labels</li>
<li><strong>Predict:</strong> predict the label of the most similar training images</li>
</ol>
<h4 id="CIFAR-10-Dataset"><a href="#CIFAR-10-Dataset" class="headerlink" title="CIFAR-10 Dataset"></a>CIFAR-10 Dataset</h4><ul>
<li>10 labels</li>
<li>50,000 training images, each image is tiny 32*32*3</li>
<li>10,000 test images</li>
</ul>
<p><img src="/images/cifar10.jpg" alt="CIFAR-10"></p>
<h4 id="Distance-metric"><a href="#Distance-metric" class="headerlink" title="Distance metric"></a>Distance metric</h4><p><strong>Q.</strong> How do we <strong>compare</strong> the images? What is the <strong>distance metric</strong>?</p>
<p><strong>A.</strong><br>$\sum_{i=0}^n i^2 = \frac{(n^2+n)(2n+1)}{6}$</p>
<ol>
<li><strong>L1(Manhattan) distance:</strong> $d = \sum_{p} \left| I_1^p - I_2^p \right|$</li>
<li><strong>L2(Euclidean) distance:</strong> $d = \sqrt{\sum_{p} \left( I^p_1 - I^p_2 \right)^2}$</li>
</ol>
<p><img src="/images/L1dist.jpeg" alt=""></p>
<h4 id="Nearest-Neighbor-Code"><a href="#Nearest-Neighbor-Code" class="headerlink" title="Nearest Neighbor Code"></a>Nearest Neighbor Code</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. Prepare the data</span></span><br><span class="line">Xtr, Ytr, Xte, Yte = load_CIFAR10(<span class="string">'data/cifar10/'</span>) <span class="comment"># a magic function we provide</span></span><br><span class="line"><span class="comment"># image as rows</span></span><br><span class="line">Xtr_rows = Xtr.reshape(Xtr.shape[<span class="number">0</span>], <span class="number">32</span> * <span class="number">32</span> * <span class="number">3</span>) <span class="comment"># Xtr_rows becomes 50000 x 3072</span></span><br><span class="line">Xte_rows = Xte.reshape(Xte.shape[<span class="number">0</span>], <span class="number">32</span> * <span class="number">32</span> * <span class="number">3</span>) <span class="comment"># Xte_rows becomes 10000 x 3072</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. Train &amp; evaluate the classifier</span></span><br><span class="line">nn = NearestNeighbor()</span><br><span class="line">nn.train(Xtr_rows, Ytr)</span><br><span class="line">Yte_predict = nn.predict(Xte_rows)</span><br><span class="line"><span class="keyword">print</span> <span class="string">'accuracy: %f'</span> % ( np.mean(Yte_predict == Yte) )</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. NN classifier class</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NearestNeighbor</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">train</span><span class="params">(self, X, y)</span>:</span></span><br><span class="line">    <span class="string">""" X is N x D where each row is an example. Y is 1-dimension of size N """</span></span><br><span class="line">    <span class="comment"># remember all the training set</span></span><br><span class="line">    self.Xtr = X</span><br><span class="line">    self.ytr = y</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">predict</span><span class="params">(self, X)</span>:</span></span><br><span class="line">    <span class="string">""" X is N x D where each row is an example we wish to predict label for """</span></span><br><span class="line">    num_test = X.shape[<span class="number">0</span>]</span><br><span class="line">    <span class="comment"># lets make sure that the output type matches the input type</span></span><br><span class="line">    Ypred = np.zeros(num_test, dtype = self.ytr.dtype)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># loop over all test rows</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(num_test):</span><br><span class="line">      <span class="comment"># find the nearest training image to the i'th test image</span></span><br><span class="line">      <span class="comment"># using the L1 distance (sum of absolute value differences)</span></span><br><span class="line">      distances = np.sum(np.abs(self.Xtr - X[i,:]), axis = <span class="number">1</span>)</span><br><span class="line">      min_index = np.argmin(distances) <span class="comment"># get the index with smallest distance</span></span><br><span class="line">      Ypred[i] = self.ytr[min_index] <span class="comment"># predict the label of the nearest example</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Ypred</span><br></pre></td></tr></table></figure>
<h4 id="CIFAR-10-Accuracy"><a href="#CIFAR-10-Accuracy" class="headerlink" title="CIFAR-10 Accuracy"></a>CIFAR-10 Accuracy</h4><ol>
<li>L1 distance NN classifier: 38.6%</li>
<li>L2 distance NN classifier: 35.4%</li>
<li>CNN: 95% (from a recent Kaggle competition on CIFAR-10)</li>
<li>Human performance: 94%</li>
</ol>
<h3 id="k-Nearest-Neighbor-Classifier"><a href="#k-Nearest-Neighbor-Classifier" class="headerlink" title="k - Nearest Neighbor Classifier"></a>k - Nearest Neighbor Classifier</h3><p>Find the k nearest images, have them vote on the label.</p>
<p><img src="/images/knn.jpeg" alt="k-NN"></p>
<p><strong>Q.</strong> What is the accuracy of the nearest neighbor classifier on the training data, when using the Euclidean distance?</p>
<p><strong>A.</strong> 100%. All depends on itself.</p>
<p><strong>Q2.</strong> What is the accuracy of the k-nearest neighbor classifier on the training data?</p>
<p><strong>A.</strong> Not sure…Depends on it’s k neighbors.</p>
<p><strong>Q3.</strong> What is the best <strong>distance</strong> to use? What is the best value of <strong>k</strong> to use?</p>
<p><strong>A.</strong> Very problem-dependent. Must try them all out and see what works best. <strong>Cross validation!</strong> </p>
<blockquote>
<p>Split your training set into training set and a validation set. Use validation set to tune all hyperparameters. At the end run a single time on the test set and report performance.</p>
</blockquote>
<p>Here is what this might looks like in the case of CIFAR-10:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># assume we have Xtr_rows, Ytr, Xte_rows, Yte as before</span></span><br><span class="line"><span class="comment"># recall Xtr_rows is 50,000 x 3072 matrix</span></span><br><span class="line">Xval_rows = Xtr_rows[:<span class="number">1000</span>, :] <span class="comment"># take first 1000 for validation</span></span><br><span class="line">Yval = Ytr[:<span class="number">1000</span>]</span><br><span class="line">Xtr_rows = Xtr_rows[<span class="number">1000</span>:, :] <span class="comment"># keep last 49,000 for train</span></span><br><span class="line">Ytr = Ytr[<span class="number">1000</span>:]</span><br><span class="line"></span><br><span class="line"><span class="comment"># find hyperparameters that work best on the validation set</span></span><br><span class="line">validation_accuracies = []</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">20</span>, <span class="number">50</span>, <span class="number">100</span>]:</span><br><span class="line">  <span class="comment"># use a particular value of k and evaluation on validation data</span></span><br><span class="line">  nn = NearestNeighbor()</span><br><span class="line">  nn.train(Xtr_rows, Ytr)</span><br><span class="line">  <span class="comment"># here we assume a modified NearestNeighbor class that can take a k as input</span></span><br><span class="line">  Yval_predict = nn.predict(Xval_rows, k = k)</span><br><span class="line">  acc = np.mean(Yval_predict == Yval)</span><br><span class="line">  <span class="keyword">print</span> <span class="string">'accuracy: %f'</span> % (acc,)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># keep track of what works on the validation set</span></span><br><span class="line">  validation_accuracies.append((k, acc))</span><br></pre></td></tr></table></figure>
<p>k-Nearest Neighbor on images <strong>never used</strong> in reality cause:</p>
<ul>
<li>terrible performance at test time</li>
<li>distance metrics on level of whole images can be very unintuitive</li>
</ul>
<h2 id="Linear-Classification"><a href="#Linear-Classification" class="headerlink" title="Linear Classification"></a>Linear Classification</h2><h3 id="Parametric-approach"><a href="#Parametric-approach" class="headerlink" title="Parametric approach"></a>Parametric approach</h3><ul>
<li>Given image $X$ and label $y$</li>
<li>Find parameters $W$ of model $f$ that makes $y = f(x, W)$</li>
</ul>
<h3 id="Linear-Model"><a href="#Linear-Model" class="headerlink" title="Linear Model"></a>Linear Model</h3><h4 id="Score-function"><a href="#Score-function" class="headerlink" title="Score function"></a>Score function</h4><p>$$f(x_i, W, b) =  W\cdot x_i + b$$</p>
<p>For CIFIAR-10:</p>
<p>$$f(x_i, W, b) = W\cdot x_i+b$$</p>
<p>[10*1] = [10*3072] * [3072*1] + [10*1]</p>
<p><img src="/images/imagemap.jpg" alt=""></p>
<p><strong>Q.</strong> What does the linear classifier do?</p>
<p><strong>A.</strong> </p>
<ol>
<li>Linear Classifier take an input image $x$ from the <u>data space</u> and map it into the <u>label space</u> $y$.</li>
<li>Linear Classifier works like an <u>template</u> that uses dot product to <u>match up</u> with the input image.</li>
<li>Linear Classifier is counting <u>weight sum</u> of pixel <u>colors</u> to choose the appropriate color.</li>
</ol>
<p><img src="/images/templates.jpg" alt="templates"></p>
<p><strong>Q.</strong> What would be a very hard set of classes for a linear classifier to distinguish?</p>
<p><strong>A.</strong> </p>
<ol>
<li>The target class is not linear seperable.</li>
<li>The image is grayscale, so the ‘color counting’ is not working.</li>
</ol>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://yoursite.com/2016/06/28/1.Image_Classification_Pipeline/" data-id="cipy4blk30000oowi34xozuob" class="article-share-link">分享到</a><div class="tags"><a href="/tags/CNN/">CNN</a><a href="/tags/CS231n/">CS231n</a></div><div class="post-nav"><a href="/2016/06/26/SqueezeNet/" class="next">SqueezeNet</a></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/CNN/" style="font-size: 15px;">CNN</a> <a href="/tags/CS231n/" style="font-size: 15px;">CS231n</a> <a href="/tags/SqueezeNet/" style="font-size: 15px;">SqueezeNet</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/06/28/1.Image_Classification_Pipeline/">Lesson1@CS231n:Image Classification Pipeline</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/26/SqueezeNet/">SqueezeNet</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/25/hello-world/">Hello World</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">eKuL.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
  });
</script><script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML" async></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>